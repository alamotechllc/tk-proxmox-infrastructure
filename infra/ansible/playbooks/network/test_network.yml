---
- name: "Network Ping Test"
  hosts: localhost
  gather_facts: true
  serial: 1
  
  vars:
    target_host: "{{ target_host | default('172.23.5.1') }}"
  
  tasks:
    - name: Display test configuration
      debug:
        msg: |
          🌐 Network Ping Test Configuration
          ==================================
          Target Host: {{ target_host }}
          Timestamp: {{ ansible_date_time.iso8601 }}
    
    - name: Ping target host
      command: ping -c 3 {{ target_host }}
      register: ping_result
      failed_when: false
    
    - name: Display ping results
      debug:
        msg: |
          🎯 Ping Test Results
          ===================
          Target Host: {{ target_host }}
          Exit Code: {{ ping_result.rc }}
          {% if ping_result.rc == 0 %}
          Status: ✅ SUCCESS - Host is reachable
          {% else %}
          Status: ❌ FAILED - Host is not reachable
          {% endif %}
          
          {% if ping_result.stdout is defined %}
          Ping Output:
          {{ ping_result.stdout }}
          {% endif %}
          
          {% if ping_result.stderr is defined and ping_result.stderr != '' %}
          Error Output:
          {{ ping_result.stderr }}
          {% endif %}

  post_tasks:
    - name: Test summary
      debug:
        msg: |
          🎯 Network Ping Test Complete
          =============================
          Target Host: {{ target_host }}
          Final Status: {{ 'SUCCESS' if ping_result.rc == 0 else 'FAILED' }}
          Timestamp: {{ ansible_date_time.iso8601 }}