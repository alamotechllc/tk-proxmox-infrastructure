---
# List Switch Interfaces Template
# Dynamically displays available interfaces based on selected switch
# Helps users choose the correct port for VLAN assignment

- name: "List Available Interfaces for {{ switch_name | default('selected switch') | upper }}"
  hosts: localhost
  gather_facts: true
  
  vars:
    # Filter options
    port_filter: "{{ port_filter | default('all') }}"  # all, active, inactive, access_only
    
    # Switch-specific interface configurations
    switch_interface_configs:
      tks-sw-arista-core-1:
        name: "Arista Core Switch (tks-sw-arista-core-1)"
        ip: "172.23.7.10"
        model: "DCS-7050T-64"
        safe_ports:
          access_ports:
            - "Ethernet1/1"
            - "Ethernet1/2"
            - "Ethernet1/3"
            - "Ethernet1/4"
            - "Ethernet1/5"
            - "Ethernet1/6"
            - "Ethernet1/7"
            - "Ethernet1/8"
            - "Ethernet1/9"
            - "Ethernet1/10"
            - "Ethernet1/11"
            - "Ethernet1/12"
            - "Ethernet1/13"
            - "Ethernet1/14"
            - "Ethernet1/15"
            - "Ethernet1/16"
            - "Ethernet1/17"
            - "Ethernet1/18"
            - "Ethernet1/19"
            - "Ethernet1/20"
            - "Ethernet1/21"
            - "Ethernet1/22"
            - "Ethernet1/23"
            - "Ethernet1/24"
            - "Ethernet1/25"
            - "Ethernet1/26"
            - "Ethernet1/27"
            - "Ethernet1/28"
            - "Ethernet1/29"
            - "Ethernet1/30"
            - "Ethernet1/31"
            - "Ethernet1/32"
            - "Ethernet1/33"
            - "Ethernet1/34"
            - "Ethernet1/35"
            - "Ethernet1/36"
            - "Ethernet1/37"
            - "Ethernet1/38"
            - "Ethernet1/39"
            - "Ethernet1/40"
            - "Ethernet1/41"
            - "Ethernet1/42"
            - "Ethernet1/43"
            - "Ethernet1/44"
            - "Ethernet1/45"
            - "Ethernet1/46"
            - "Ethernet1/47"
            - "Ethernet1/48"
          high_speed_ports:
            - "Ethernet49/1 (10GbE - Protected)"
            - "Ethernet50/1 (10GbE - Protected)"
          management_ports:
            - "Management1 (Protected)"
        port_descriptions:
          "Ethernet1/1": "Office Workstation - Active"
          "Ethernet1/2": "Available - Inactive"
          "Ethernet1/3": "Available - Inactive"
          "Ethernet1/4": "Available - Inactive"
          "Ethernet1/5": "Server Connection - Active"
          "Ethernet1/6": "Available - Inactive"
          "Ethernet1/7": "Available - Inactive"
          "Ethernet1/8": "Available - Inactive"
          "Ethernet1/9": "Available - Inactive"
          "Ethernet1/10": "Available - Inactive"
          "Ethernet1/11": "Available - Inactive"
          "Ethernet1/12": "Available - Inactive"
          "Ethernet1/13": "Available - Inactive"
          "Ethernet1/14": "Available - Inactive"
          "Ethernet1/15": "Available - Inactive"
          "Ethernet1/16": "Available - Inactive"
          "Ethernet1/17": "Available - Inactive"
          "Ethernet1/18": "Available - Inactive"
          "Ethernet1/19": "Available - Inactive"
          "Ethernet1/20": "Available - Inactive"
          "Ethernet1/21": "Available - Inactive"
          "Ethernet1/22": "Available - Inactive"
          "Ethernet1/23": "Available - Inactive"
          "Ethernet1/24": "Available - Inactive"
          "Ethernet1/25": "Available - Inactive"
          "Ethernet1/26": "Available - Inactive"
          "Ethernet1/27": "Available - Inactive"
          "Ethernet1/28": "Available - Inactive"
          "Ethernet1/29": "Available - Inactive"
          "Ethernet1/30": "Available - Inactive"
          "Ethernet1/31": "Available - Inactive"
          "Ethernet1/32": "Available - Inactive"
          "Ethernet1/33": "Available - Inactive"
          "Ethernet1/34": "Available - Inactive"
          "Ethernet1/35": "Available - Inactive"
          "Ethernet1/36": "Available - Inactive"
          "Ethernet1/37": "Available - Inactive"
          "Ethernet1/38": "Available - Inactive"
          "Ethernet1/39": "Available - Inactive"
          "Ethernet1/40": "Available - Inactive"
          "Ethernet1/41": "Available - Inactive"
          "Ethernet1/42": "Available - Inactive"
          "Ethernet1/43": "Available - Inactive"
          "Ethernet1/44": "Available - Inactive"
          "Ethernet1/45": "Available - Inactive"
          "Ethernet1/46": "Available - Inactive"
          "Ethernet1/47": "Available - Inactive"
          "Ethernet1/48": "Available - Inactive"

      tks-sw-cis-nexus-1:
        name: "Cisco Nexus Access Switch (tks-sw-cis-nexus-1)"
        ip: "210.141.77.15"
        model: "N9K-C93180YC-EX"
        safe_ports:
          access_ports:
            - "Ethernet1/1"
            - "Ethernet1/2"
            - "Ethernet1/3"
            - "Ethernet1/4"
            - "Ethernet1/5"
            - "Ethernet1/6"
            - "Ethernet1/7"
            - "Ethernet1/8"
            - "Ethernet1/9"
            - "Ethernet1/10"
            - "Ethernet1/11"
            - "Ethernet1/12"
            - "Ethernet1/13"
            - "Ethernet1/14"
            - "Ethernet1/15"
            - "Ethernet1/16"
            - "Ethernet1/17"
            - "Ethernet1/18"
            - "Ethernet1/19"
            - "Ethernet1/20"
            - "Ethernet1/21"
            - "Ethernet1/22"
            - "Ethernet1/23"
            - "Ethernet1/24"
            - "Ethernet1/25"
            - "Ethernet1/26"
            - "Ethernet1/27"
            - "Ethernet1/28"
            - "Ethernet1/29"
            - "Ethernet1/30"
            - "Ethernet1/31"
            - "Ethernet1/32"
            - "Ethernet1/33"
            - "Ethernet1/34"
            - "Ethernet1/35"
            - "Ethernet1/36"
            - "Ethernet1/37"
            - "Ethernet1/38"
            - "Ethernet1/39"
            - "Ethernet1/40"
            - "Ethernet1/41"
            - "Ethernet1/42"
            - "Ethernet1/43"
            - "Ethernet1/44"
            - "Ethernet1/45"
            - "Ethernet1/46"
            - "Ethernet1/47"
            - "Ethernet1/48"
          gaming_ports:
            - "Ethernet1/18 (Gaming Zone)"
            - "Ethernet1/19 (Gaming Zone)"
            - "Ethernet1/20 (Gaming Zone)"
            - "Ethernet1/21 (Gaming Zone)"
            - "Ethernet1/22 (Gaming Zone)"
            - "Ethernet1/23 (Gaming Zone)"
            - "Ethernet1/24 (Gaming Zone)"
            - "Ethernet1/25 (Gaming Zone)"
            - "Ethernet1/26 (Gaming Zone)"
            - "Ethernet1/27 (Gaming Zone)"
            - "Ethernet1/28 (Gaming Zone)"
            - "Ethernet1/29 (Gaming Zone)"
            - "Ethernet1/30 (Gaming Zone)"
            - "Ethernet1/31 (Gaming Zone)"
            - "Ethernet1/32 (Gaming Zone)"
            - "Ethernet1/33 (Gaming Zone)"
            - "Ethernet1/34 (Gaming Zone)"
            - "Ethernet1/35 (Gaming Zone)"
            - "Ethernet1/36 (Gaming Zone)"
            - "Ethernet1/37 (Gaming Zone)"
            - "Ethernet1/38 (Gaming Zone)"
            - "Ethernet1/39 (Gaming Zone)"
            - "Ethernet1/40 (Gaming Zone)"
            - "Ethernet1/41 (Gaming Zone)"
            - "Ethernet1/42 (Gaming Zone)"
            - "Ethernet1/43 (Gaming Zone)"
            - "Ethernet1/44 (Gaming Zone)"
            - "Ethernet1/45 (Gaming Zone)"
            - "Ethernet1/46 (Gaming Zone)"
          trunk_ports:
            - "Ethernet1/50 (Proxmox Trunk - Protected)"
            - "Ethernet1/52 (TrueNAS Trunk - Protected)"
          management_ports:
            - "mgmt0 (Management - Protected)"
            - "port-channel1 (LAG to Arista - Protected)"

      tks-sw-access-1:
        name: "Access Layer Switch (8-port)"
        ip: "172.23.7.20"
        model: "8-Port Gigabit Switch"
        safe_ports:
          access_ports:
            - "GigabitEthernet0/1"
            - "GigabitEthernet0/2"
            - "GigabitEthernet0/3"
            - "GigabitEthernet0/4"
            - "GigabitEthernet0/5"
            - "GigabitEthernet0/6"
            - "GigabitEthernet0/7"
          uplink_ports:
            - "GigabitEthernet0/8 (Uplink to Arista - Protected)"
        port_descriptions:
          "GigabitEthernet0/1": "Office Workstation - Active"
          "GigabitEthernet0/2": "Mac Studio - Active"
          "GigabitEthernet0/3": "Office Communications - Active"
          "GigabitEthernet0/4": "Wireless Access Point - Active"
          "GigabitEthernet0/5": "Xbox Gaming Console - Active"
          "GigabitEthernet0/6": "Nintendo Switch - Active"
          "GigabitEthernet0/7": "Available - Inactive"

    # VLAN definitions for reference
    vlan_definitions:
      2: "SERVERS - Server infrastructure (172.23.2.0/24)"
      3: "WORKSTATIONS - User workstations (172.23.3.0/24)"
      4: "GUEST - Guest network (172.23.4.0/24)"
      5: "IOT - IoT devices (172.23.5.0/24)"
      6: "GAMING - Gaming/entertainment (172.23.6.0/24)"
      7: "MANAGEMENT - Network management (172.23.7.0/24)"

  pre_tasks:
    - name: Display operation details
      debug:
        msg:
          - "=== SWITCH INTERFACE LISTING ==="
          - "Switch: {{ switch_name | default('NOT SELECTED') }}"
          - "Filter: {{ port_filter | default('all') }}"
          - "================================"

    - name: Validate switch_name is provided
      fail:
        msg: |
          Switch name is required!
          
          Please provide switch_name variable:
          - switch_name: Switch to query (arista_core, cisco_nexus, access_switch)
          
          Current value: {{ switch_name | default('NOT SET') }}
          
          Valid switches: arista_core, cisco_nexus, access_switch
      when: switch_name | default('') == ''

    - name: Validate switch configuration exists
      fail:
        msg: |
          Switch '{{ switch_name }}' not found in configuration!
          
          Valid switches:
          - arista_core: Arista Core Switch (tks-sw-arista-core-1)
          - cisco_nexus: Cisco Nexus Switch (tks-sw-cis-nexus-1)
          - access_switch: Access Layer Switch (8-port)
      when: switch_name not in switch_interface_configs

    - name: Get switch interface configuration
      set_fact:
        switch_config: "{{ switch_interface_configs[switch_name] }}"

  tasks:
    - name: Display switch information
      debug:
        msg:
          - "=== SWITCH INFORMATION ==="
          - "Name: {{ switch_config.name }}"
          - "IP Address: {{ switch_config.ip }}"
          - "Model: {{ switch_config.model }}"
          - "========================="

    - name: Filter access ports by status
      set_fact:
        filtered_access_ports: >-
          {{
            switch_config.safe_ports.access_ports | selectattr('', 'defined') |
            select('match', '.*') |
            map('regex_replace', '^(.*)$', '\1') |
            list
          }}

    - name: Display filtered access ports
      debug:
        msg: |
          🔌 ACCESS PORTS ({{ port_filter | upper }} FILTER)
          ================================================
          {% set active_count = 0 %}
          {% set inactive_count = 0 %}
          {% set displayed_count = 0 %}
          
          {% for port in switch_config.safe_ports.access_ports %}
            {% set port_desc = switch_config.port_descriptions.get(port, 'Available - Access Port') if switch_config.port_descriptions is defined else 'Available - Access Port' %}
            {% set is_active = 'Active' in port_desc %}
            {% set is_inactive = 'Inactive' in port_desc %}
            
            {% if is_active %}
              {% set active_count = active_count + 1 %}
            {% elif is_inactive %}
              {% set inactive_count = inactive_count + 1 %}
            {% endif %}
            
            {% if port_filter == 'all' or 
                  (port_filter == 'active' and is_active) or 
                  (port_filter == 'inactive' and is_inactive) or 
                  (port_filter == 'access_only') %}
              {% set displayed_count = displayed_count + 1 %}
          {{ displayed_count }}. {{ port }} - {{ port_desc }}
            {% endif %}
          {% endfor %}
          
          📊 SUMMARY:
          - Total Access Ports: {{ switch_config.safe_ports.access_ports | length }}
          - Active Ports: {{ active_count }}
          - Inactive Ports: {{ inactive_count }}
          - Displayed: {{ displayed_count }} ({{ port_filter }} filter)
          
          {% if port_filter == 'access_only' %}
          📝 Showing only access ports (no trunk ports or LAGs)
          {% elif port_filter == 'active' %}
          📝 Showing only active ports (currently in use)
          {% elif port_filter == 'inactive' %}
          📝 Showing only inactive ports (available for assignment)
          {% else %}
          📝 Showing all access ports
          {% endif %}

    - name: Display gaming zone ports (Cisco Nexus only)
      debug:
        msg: |
          🎮 GAMING ZONE PORTS (Cisco Nexus - VLAN 6 Recommended)
          =======================================================
          {% for port in switch_config.safe_ports.get('gaming_ports', []) %}
          {{ loop.index }}. {{ port }}
          {% endfor %}
          
          🎯 These ports are optimized for gaming devices.
      when: switch_config.safe_ports.get('gaming_ports') is defined

    - name: Display high-speed ports (Arista Core only)
      debug:
        msg: |
          ⚡ HIGH-SPEED PORTS (Arista Core - 10GbE)
          =========================================
          {% for port in switch_config.safe_ports.get('high_speed_ports', []) %}
          {{ loop.index }}. {{ port }}
          {% endfor %}
          
          🚀 These ports support 10GbE connections.
      when: switch_config.safe_ports.get('high_speed_ports') is defined

    - name: Display trunk ports
      debug:
        msg: |
          🔗 TRUNK PORTS (Protected - Do Not Modify)
          ==========================================
          {% for port in switch_config.safe_ports.get('trunk_ports', []) %}
          {{ loop.index }}. {{ port }}
          {% endfor %}
          
          ⚠️  These ports are protected and should not be modified.

    - name: Display management ports
      debug:
        msg: |
          🛠️  MANAGEMENT PORTS (Protected - Do Not Modify)
          ===============================================
          {% for port in switch_config.safe_ports.get('management_ports', []) %}
          {{ loop.index }}. {{ port }}
          {% endfor %}
          
          ⚠️  These ports are protected and should not be modified.

    - name: Display uplink ports (Access Switch only)
      debug:
        msg: |
          🔗 UPLINK PORTS (Access Switch - Protected)
          ===========================================
          {% for port in switch_config.safe_ports.get('uplink_ports', []) %}
          {{ loop.index }}. {{ port }}
          {% endfor %}
          
          ⚠️  These ports are protected and should not be modified.
      when: switch_config.safe_ports.get('uplink_ports') is defined

    - name: Display VLAN reference
      debug:
        msg: |
          🏷️  AVAILABLE VLANS FOR ASSIGNMENT
          ==================================
          {% for vlan_id, vlan_info in vlan_definitions.items() %}
          VLAN {{ vlan_id }}: {{ vlan_info }}
          {% endfor %}
          
          📋 Use these VLAN IDs when assigning ports.

    - name: Display usage examples
      debug:
        msg: |
          💡 USAGE EXAMPLES
          ================
          
          For VLAN Assignment:
          - switch_name: {{ switch_name }}
          - port_interface: Ethernet1/10 (choose from available ports above)
          - vlan_id: 3 (choose from VLAN list above)
          - port_desc: "User Workstation"
          
          Filter Options:
          - port_filter: all (show all access ports)
          - port_filter: active (show only active ports)
          - port_filter: inactive (show only inactive ports)
          - port_filter: access_only (show access ports, exclude trunk/LAG)
          
          Common Port Assignments:
          {% if switch_name == 'arista_core' %}
          - Ethernet1/10: Office workstation (VLAN 3)
          - Ethernet1/15: Server connection (VLAN 2)
          - Ethernet1/20: IoT device (VLAN 5)
          {% elif switch_name == 'cisco_nexus' %}
          - Ethernet1/18: Gaming console (VLAN 6)
          - Ethernet1/25: Office workstation (VLAN 3)
          - Ethernet1/30: IoT device (VLAN 5)
          {% elif switch_name == 'access_switch' %}
          - GigabitEthernet0/3: Office workstation (VLAN 3)
          - GigabitEthernet0/5: Gaming console (VLAN 6)
          - GigabitEthernet0/7: Available for new device
          {% endif %}

  post_tasks:
    - name: Display summary
      debug:
        msg:
          - "=== INTERFACE LISTING COMPLETE ==="
          - "Switch: {{ switch_config.name }}"
          - "Total Access Ports: {{ switch_config.safe_ports.access_ports | length }}"
          - "Protected Ports: {{ (switch_config.safe_ports.get('trunk_ports', []) + switch_config.safe_ports.get('management_ports', []) + switch_config.safe_ports.get('uplink_ports', [])) | length }}"
          - "================================"
          - "Use this information to select the correct port for VLAN assignment."
